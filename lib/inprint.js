"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.handleFile = handleFile;
exports.callEmbeddedFeatures = callEmbeddedFeatures;
exports.doInprint = doInprint;
exports.run = run;
exports.writeFileSyncIfChanged = exports.usageNotice = exports.endPrefix = exports.startPrefix = exports.inprint_prefix = void 0;

var _json = _interopRequireDefault(require("json5"));

var _globby = _interopRequireDefault(require("globby"));

var _fs = require("fs");

var _path = require("path");

var _embeddedFeatures = require("./embeddedFeatures");

var _InprintOptions = require("./InprintOptions");

var _formatTypescript = require("./formatTypescript");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const inprint_prefix = "@" + "INPRINT";
exports.inprint_prefix = inprint_prefix;
const startPrefix = "_START";
exports.startPrefix = startPrefix;
const endPrefix = "_END";
exports.endPrefix = endPrefix;
const usageNotice = `
USAGE:

// ${inprint_prefix}_START {...any_json_params...}
// Generated code will go here
// ${inprint_prefix}_END
`;
exports.usageNotice = usageNotice;

const writeFileSyncIfChanged = (fileName, content) => {
  let current;

  try {
    current = (0, _fs.readFileSync)(fileName, "utf-8");
  } catch (e) {}

  if (current !== content) {
    (0, _fs.writeFileSync)(fileName, content, "utf-8");
    return true;
  }

  return false;
};

exports.writeFileSyncIfChanged = writeFileSyncIfChanged;

function handleFile(filePath, options) {
  const contentStr = (0, _fs.readFileSync)(filePath, "utf-8");
  if (!contentStr.includes(inprint_prefix)) return false;
  const [fileHeader, ...parts0] = contentStr.split(inprint_prefix);
  const parts = [];

  for (let i = 0; i < parts0.length; i += 2) {
    const s = parts0[i];

    if (!s.startsWith(startPrefix)) {
      console.error(`CODE00000001 INPRINT_ERROR No ${inprint_prefix}${startPrefix} in ${filePath}`);
      return false;
    }

    if (!parts0[i + 1].startsWith(endPrefix)) {
      console.error(`CODE00000002 INPRINT_ERROR No ${inprint_prefix}${endPrefix} in ${filePath}`);
    }

    try {
      const [header, ...middleParts] = s.split("\n");
      const lastPart = middleParts.pop();
      const paramsStr = header.substr(startPrefix.length).trim();
      const middle = middleParts.join("\n");
      const tail = lastPart + inprint_prefix + parts0[i + 1];

      const params = _objectSpread({
        content: middle,
        absolutePath: filePath
      }, _json.default.parse(paramsStr));

      parts.push({
        header,
        params,
        middle,
        tail,
        newMiddle: ""
      });
    } catch (e) {
      console.error(`CODE00000003 INPRINT_ERROR ${e.message} in ${filePath}`);
      return false;
    }
  }

  for (let part of parts) {
    try {
      part.newMiddle = doInprint(part.params, options);
    } catch (e) {
      part.newMiddle = `// INPRINT_FAILED because of exception:\n${e.message || "NO_ERROR_MESSAGE"}\\n${e.stack || "NO_STACK_TRACE"}`.split("\n").join("\n//     ");
    }
  }

  const newContent = (0, _formatTypescript.formatTypescript)(fileHeader + inprint_prefix + parts.map(p => `${p.header}\n${p.newMiddle}\n${p.tail}`).join(inprint_prefix), options.prettierOpts);
  writeFileSyncIfChanged(filePath, newContent);
  return true;
}

function callEmbeddedFeatures(params, options) {
  for (let embeddedFeature of _embeddedFeatures.embeddedFeatures) {
    const r = embeddedFeature.func(params, options);
    if (r) return r;
  }

  return undefined;
}

function doInprint(params, options) {
  if (options.embeddedFeatures === "first" || options.embeddedFeatures === true) {
    const r = callEmbeddedFeatures(params, options);
    if (r) return r;
  }

  if (options.inprint) {
    const r = options.inprint(params, options);
    if (r) return r;
  }

  if (options.embeddedFeatures === "last") {
    const r = callEmbeddedFeatures(params, options);
    if (r) return r;
  }

  return `// INPRINT_ERROR None of inprint functions returned a result. They all returned undefined!`;
} // const testFilePath = `D:\\b\\Mine\\GIT_Work\\yatasks_one_api\\src\\inprintTestFile.ts`;
// handleFile(testFilePath);


function run(options0) {
  if (process.argv[2] === "--version" || process.argv[2] === "-v") {
    // @ts-ignore
    console.log("1.2.8");
    return;
  }

  let optionsPath = undefined;
  if (process.argv[2]) try {
    if (!options0) {
      optionsPath = process.argv[2];
      options0 = require(optionsPath);
    }
  } catch (e) {
    console.error(`CODE00000004 INPRINT failed to load '${optionsPath}' because of exception:`);
    console.error(e);
    process.exit(1);
    return;
  }

  try {
    if (!options0) {
      optionsPath = (0, _path.resolve)(process.cwd(), "inprint.cjs");
      options0 = require(optionsPath);
    }
  } catch (e) {
    if (e.code !== "MODULE_NOT_FOUND" || e.message.split("'")[1] !== optionsPath) {
      console.error(`CODE00000008 INPRINT failed to load '${optionsPath}' because of exception:`);
      console.error(e);
      process.exit(1);
      return;
    }
  }

  try {
    if (!options0) {
      optionsPath = (0, _path.resolve)(process.cwd(), "inprint.js");
      options0 = require(optionsPath);
    }
  } catch (e) {
    if (e.code !== "MODULE_NOT_FOUND" || e.message.split("'")[1] !== optionsPath) {
      console.error(`CODE00000009 INPRINT failed to load '${optionsPath}' because of exception:`);
      console.error(e);
      process.exit(1);
      return;
    }
  }

  if (!options0) optionsPath = "<default options>";

  const options = _objectSpread(_objectSpread({}, _InprintOptions.defaultInprintOptions), options0);

  let processedCount = 0;

  (async () => {
    if (options.logging) console.log(`CODE00000005 INPRINT options from ${optionsPath}`);
    const paths = await (0, _globby.default)(options.files);

    for (let filePath of paths) {
      if (options.logging === "files") console.log(`CODE00000006 INPRINT ${filePath}`);
      if (filePath.includes("node_modules") && options.skipNodeModules) continue;
      if (handleFile(filePath, options)) processedCount++;
    }

    if (options.logging) console.log(`CODE00000007 INPRINT finished, ${paths.length} - total files, ${processedCount} - processed, ${paths.length - processedCount} - skipped`);
    if (options.forceProcessTermination) process.exit(0);
  })();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbnByaW50LnRzIl0sIm5hbWVzIjpbImlucHJpbnRfcHJlZml4Iiwic3RhcnRQcmVmaXgiLCJlbmRQcmVmaXgiLCJ1c2FnZU5vdGljZSIsIndyaXRlRmlsZVN5bmNJZkNoYW5nZWQiLCJmaWxlTmFtZSIsImNvbnRlbnQiLCJjdXJyZW50IiwiZSIsImhhbmRsZUZpbGUiLCJmaWxlUGF0aCIsIm9wdGlvbnMiLCJjb250ZW50U3RyIiwiaW5jbHVkZXMiLCJmaWxlSGVhZGVyIiwicGFydHMwIiwic3BsaXQiLCJwYXJ0cyIsImkiLCJsZW5ndGgiLCJzIiwic3RhcnRzV2l0aCIsImNvbnNvbGUiLCJlcnJvciIsImhlYWRlciIsIm1pZGRsZVBhcnRzIiwibGFzdFBhcnQiLCJwb3AiLCJwYXJhbXNTdHIiLCJzdWJzdHIiLCJ0cmltIiwibWlkZGxlIiwiam9pbiIsInRhaWwiLCJwYXJhbXMiLCJhYnNvbHV0ZVBhdGgiLCJKU09ONSIsInBhcnNlIiwicHVzaCIsIm5ld01pZGRsZSIsIm1lc3NhZ2UiLCJwYXJ0IiwiZG9JbnByaW50Iiwic3RhY2siLCJuZXdDb250ZW50IiwibWFwIiwicCIsInByZXR0aWVyT3B0cyIsImNhbGxFbWJlZGRlZEZlYXR1cmVzIiwiZW1iZWRkZWRGZWF0dXJlIiwiZW1iZWRkZWRGZWF0dXJlcyIsInIiLCJmdW5jIiwidW5kZWZpbmVkIiwiaW5wcmludCIsInJ1biIsIm9wdGlvbnMwIiwicHJvY2VzcyIsImFyZ3YiLCJsb2ciLCJvcHRpb25zUGF0aCIsInJlcXVpcmUiLCJleGl0IiwiY3dkIiwiY29kZSIsImRlZmF1bHRJbnByaW50T3B0aW9ucyIsInByb2Nlc3NlZENvdW50IiwibG9nZ2luZyIsInBhdGhzIiwiZmlsZXMiLCJza2lwTm9kZU1vZHVsZXMiLCJmb3JjZVByb2Nlc3NUZXJtaW5hdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7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QUFJdkQsT0FBTyxDQUFDd0QsT0FBWixFQUNJN0MsT0FBTyxDQUFDcUMsR0FBUixDQUNLLGtDQUFpQ1MsS0FBSyxDQUFDakQsTUFBTyxtQkFBa0IrQyxjQUFlLGlCQUM1RUUsS0FBSyxDQUFDakQsTUFBTixHQUFlK0MsY0FDbEIsWUFITDtBQUtKLFFBQUd2RCxPQUFPLENBQUM0RCx1QkFBWCxFQUNJZCxPQUFPLENBQUNLLElBQVIsQ0FBYSxDQUFiO0FBQ1AsR0FqQkQ7QUFrQkgiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSlNPTjUgZnJvbSBcImpzb241XCI7XHJcbmltcG9ydCBnbG9iYnkgZnJvbSBcImdsb2JieVwiO1xyXG5pbXBvcnQgeyByZWFkRmlsZVN5bmMsIHdyaXRlRmlsZVN5bmMgfSBmcm9tIFwiZnNcIjtcclxuaW1wb3J0IHsgcmVzb2x2ZSB9IGZyb20gXCJwYXRoXCI7XHJcbmltcG9ydCB7IGVtYmVkZGVkRmVhdHVyZXMgfSBmcm9tIFwiLi9lbWJlZGRlZEZlYXR1cmVzXCI7XHJcbmltcG9ydCB7IGRlZmF1bHRJbnByaW50T3B0aW9ucywgSW5wcmludE9wdGlvbnMgfSBmcm9tIFwiLi9JbnByaW50T3B0aW9uc1wiO1xyXG5pbXBvcnQgeyBmb3JtYXRUeXBlc2NyaXB0IH0gZnJvbSBcIi4vZm9ybWF0VHlwZXNjcmlwdFwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IGlucHJpbnRfcHJlZml4ID0gXCJAXCIgKyBcIklOUFJJTlRcIjtcclxuZXhwb3J0IGNvbnN0IHN0YXJ0UHJlZml4ID0gXCJfU1RBUlRcIjtcclxuZXhwb3J0IGNvbnN0IGVuZFByZWZpeCA9IFwiX0VORFwiO1xyXG5leHBvcnQgY29uc3QgdXNhZ2VOb3RpY2UgPSBgXHJcblVTQUdFOlxyXG5cclxuLy8gJHtpbnByaW50X3ByZWZpeH1fU1RBUlQgey4uLmFueV9qc29uX3BhcmFtcy4uLn1cclxuLy8gR2VuZXJhdGVkIGNvZGUgd2lsbCBnbyBoZXJlXHJcbi8vICR7aW5wcmludF9wcmVmaXh9X0VORFxyXG5gO1xyXG5cclxuaW50ZXJmYWNlIElucHJpbnRGaWxlUGFydCB7XHJcbiAgICBoZWFkZXI6IHN0cmluZztcclxuICAgIHBhcmFtczogYW55O1xyXG4gICAgbWlkZGxlOiBzdHJpbmc7XHJcbiAgICB0YWlsOiBzdHJpbmc7XHJcbiAgICBuZXdNaWRkbGU6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHdyaXRlRmlsZVN5bmNJZkNoYW5nZWQgPSAoZmlsZU5hbWU6IHN0cmluZywgY29udGVudDogc3RyaW5nKSA9PiB7XHJcbiAgICBsZXQgY3VycmVudDogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjdXJyZW50ID0gcmVhZEZpbGVTeW5jKGZpbGVOYW1lLCBcInV0Zi04XCIpO1xyXG4gICAgfSBjYXRjaCAoZSkge31cclxuXHJcbiAgICBpZiAoY3VycmVudCAhPT0gY29udGVudCkge1xyXG4gICAgICAgIHdyaXRlRmlsZVN5bmMoZmlsZU5hbWUsIGNvbnRlbnQsIFwidXRmLThcIik7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlRmlsZShmaWxlUGF0aDogc3RyaW5nLCBvcHRpb25zOiBJbnByaW50T3B0aW9ucyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgY29udGVudFN0ciA9IHJlYWRGaWxlU3luYyhmaWxlUGF0aCwgXCJ1dGYtOFwiKTtcclxuXHJcbiAgICBpZiAoIWNvbnRlbnRTdHIuaW5jbHVkZXMoaW5wcmludF9wcmVmaXgpKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgY29uc3QgW2ZpbGVIZWFkZXIsIC4uLnBhcnRzMF0gPSBjb250ZW50U3RyLnNwbGl0KGlucHJpbnRfcHJlZml4KTtcclxuICAgIGNvbnN0IHBhcnRzOiBJbnByaW50RmlsZVBhcnRbXSA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXJ0czAubGVuZ3RoOyBpICs9IDIpIHtcclxuICAgICAgICBjb25zdCBzID0gcGFydHMwW2ldO1xyXG4gICAgICAgIGlmICghcy5zdGFydHNXaXRoKHN0YXJ0UHJlZml4KSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBDT0RFMDAwMDAwMDEgSU5QUklOVF9FUlJPUiBObyAke2lucHJpbnRfcHJlZml4fSR7c3RhcnRQcmVmaXh9IGluICR7ZmlsZVBhdGh9YCk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghcGFydHMwW2kgKyAxXS5zdGFydHNXaXRoKGVuZFByZWZpeCkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgQ09ERTAwMDAwMDAyIElOUFJJTlRfRVJST1IgTm8gJHtpbnByaW50X3ByZWZpeH0ke2VuZFByZWZpeH0gaW4gJHtmaWxlUGF0aH1gKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IFtoZWFkZXIsIC4uLm1pZGRsZVBhcnRzXSA9IHMuc3BsaXQoXCJcXG5cIik7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhc3RQYXJ0ID0gbWlkZGxlUGFydHMucG9wKCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwYXJhbXNTdHIgPSBoZWFkZXIuc3Vic3RyKHN0YXJ0UHJlZml4Lmxlbmd0aCkudHJpbSgpO1xyXG4gICAgICAgICAgICBjb25zdCBtaWRkbGUgPSBtaWRkbGVQYXJ0cy5qb2luKFwiXFxuXCIpO1xyXG4gICAgICAgICAgICBjb25zdCB0YWlsID0gbGFzdFBhcnQgKyBpbnByaW50X3ByZWZpeCArIHBhcnRzMFtpICsgMV07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiBtaWRkbGUsXHJcbiAgICAgICAgICAgICAgICBhYnNvbHV0ZVBhdGg6IGZpbGVQYXRoLFxyXG4gICAgICAgICAgICAgICAgLi4uSlNPTjUucGFyc2UocGFyYW1zU3RyKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcGFydHMucHVzaCh7IGhlYWRlciwgcGFyYW1zLCBtaWRkbGUsIHRhaWwsIG5ld01pZGRsZTogXCJcIiB9KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYENPREUwMDAwMDAwMyBJTlBSSU5UX0VSUk9SICR7ZS5tZXNzYWdlfSBpbiAke2ZpbGVQYXRofWApO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IHBhcnQgb2YgcGFydHMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBwYXJ0Lm5ld01pZGRsZSA9IGRvSW5wcmludChwYXJ0LnBhcmFtcywgb3B0aW9ucyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBwYXJ0Lm5ld01pZGRsZSA9IGAvLyBJTlBSSU5UX0ZBSUxFRCBiZWNhdXNlIG9mIGV4Y2VwdGlvbjpcXG4ke2UubWVzc2FnZSB8fCBcIk5PX0VSUk9SX01FU1NBR0VcIn1cXFxcbiR7XHJcbiAgICAgICAgICAgICAgICBlLnN0YWNrIHx8IFwiTk9fU1RBQ0tfVFJBQ0VcIlxyXG4gICAgICAgICAgICB9YFxyXG4gICAgICAgICAgICAgICAgLnNwbGl0KFwiXFxuXCIpXHJcbiAgICAgICAgICAgICAgICAuam9pbihcIlxcbi8vICAgICBcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5ld0NvbnRlbnQgPWZvcm1hdFR5cGVzY3JpcHQoXHJcbiAgICAgICAgZmlsZUhlYWRlciArIGlucHJpbnRfcHJlZml4ICsgcGFydHMubWFwKChwKSA9PiBgJHtwLmhlYWRlcn1cXG4ke3AubmV3TWlkZGxlfVxcbiR7cC50YWlsfWApLmpvaW4oaW5wcmludF9wcmVmaXgpLCBvcHRpb25zLnByZXR0aWVyT3B0cyk7XHJcbiAgICB3cml0ZUZpbGVTeW5jSWZDaGFuZ2VkKGZpbGVQYXRoLCBuZXdDb250ZW50KTtcclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FsbEVtYmVkZGVkRmVhdHVyZXMocGFyYW1zOiBhbnksIG9wdGlvbnM6IElucHJpbnRPcHRpb25zKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICAgIGZvciAobGV0IGVtYmVkZGVkRmVhdHVyZSBvZiBlbWJlZGRlZEZlYXR1cmVzKSB7XHJcbiAgICAgICAgY29uc3QgciA9IGVtYmVkZGVkRmVhdHVyZS5mdW5jKHBhcmFtcywgb3B0aW9ucyk7XHJcbiAgICAgICAgaWYgKHIpIHJldHVybiByO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRvSW5wcmludChwYXJhbXM6IGFueSwgb3B0aW9uczogSW5wcmludE9wdGlvbnMpOiBzdHJpbmcge1xyXG4gICAgaWYgKG9wdGlvbnMuZW1iZWRkZWRGZWF0dXJlcyA9PT0gXCJmaXJzdFwiIHx8IG9wdGlvbnMuZW1iZWRkZWRGZWF0dXJlcyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IHIgPSBjYWxsRW1iZWRkZWRGZWF0dXJlcyhwYXJhbXMsIG9wdGlvbnMpO1xyXG4gICAgICAgIGlmIChyKSByZXR1cm4gcjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3B0aW9ucy5pbnByaW50KSB7XHJcbiAgICAgICAgY29uc3QgciA9IG9wdGlvbnMuaW5wcmludChwYXJhbXMsIG9wdGlvbnMpO1xyXG4gICAgICAgIGlmIChyKSByZXR1cm4gcjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3B0aW9ucy5lbWJlZGRlZEZlYXR1cmVzID09PSBcImxhc3RcIikge1xyXG4gICAgICAgIGNvbnN0IHIgPSBjYWxsRW1iZWRkZWRGZWF0dXJlcyhwYXJhbXMsIG9wdGlvbnMpO1xyXG4gICAgICAgIGlmIChyKSByZXR1cm4gcjtcclxuICAgIH1cclxuICAgIHJldHVybiBgLy8gSU5QUklOVF9FUlJPUiBOb25lIG9mIGlucHJpbnQgZnVuY3Rpb25zIHJldHVybmVkIGEgcmVzdWx0LiBUaGV5IGFsbCByZXR1cm5lZCB1bmRlZmluZWQhYDtcclxufVxyXG5cclxuLy8gY29uc3QgdGVzdEZpbGVQYXRoID0gYEQ6XFxcXGJcXFxcTWluZVxcXFxHSVRfV29ya1xcXFx5YXRhc2tzX29uZV9hcGlcXFxcc3JjXFxcXGlucHJpbnRUZXN0RmlsZS50c2A7XHJcbi8vIGhhbmRsZUZpbGUodGVzdEZpbGVQYXRoKTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBydW4ob3B0aW9uczA/OiBJbnByaW50T3B0aW9ucyB8IHVuZGVmaW5lZCkge1xyXG4gICAgaWYgKHByb2Nlc3MuYXJndlsyXSA9PT0gXCItLXZlcnNpb25cIiB8fCBwcm9jZXNzLmFyZ3ZbMl0gPT09IFwiLXZcIikge1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBjb25zb2xlLmxvZyhfX1ZFUlNJT05fXyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBvcHRpb25zUGF0aDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xyXG4gICAgaWYgKHByb2Nlc3MuYXJndlsyXSlcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMwKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zUGF0aCA9IHByb2Nlc3MuYXJndlsyXTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMwID0gcmVxdWlyZShvcHRpb25zUGF0aCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYENPREUwMDAwMDAwNCBJTlBSSU5UIGZhaWxlZCB0byBsb2FkICcke29wdGlvbnNQYXRofScgYmVjYXVzZSBvZiBleGNlcHRpb246YCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGlmICghb3B0aW9uczApIHtcclxuICAgICAgICAgICAgb3B0aW9uc1BhdGggPSByZXNvbHZlKHByb2Nlc3MuY3dkKCksIFwiaW5wcmludC5janNcIik7XHJcbiAgICAgICAgICAgIG9wdGlvbnMwID0gcmVxdWlyZShvcHRpb25zUGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGlmIChlLmNvZGUgIT09IFwiTU9EVUxFX05PVF9GT1VORFwiIHx8IGUubWVzc2FnZS5zcGxpdChcIidcIilbMV0gIT09IG9wdGlvbnNQYXRoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYENPREUwMDAwMDAwOCBJTlBSSU5UIGZhaWxlZCB0byBsb2FkICcke29wdGlvbnNQYXRofScgYmVjYXVzZSBvZiBleGNlcHRpb246YCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGlmICghb3B0aW9uczApIHtcclxuICAgICAgICAgICAgb3B0aW9uc1BhdGggPSByZXNvbHZlKHByb2Nlc3MuY3dkKCksIFwiaW5wcmludC5qc1wiKTtcclxuICAgICAgICAgICAgb3B0aW9uczAgPSByZXF1aXJlKG9wdGlvbnNQYXRoKTtcclxuICAgICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgaWYgKGUuY29kZSAhPT0gXCJNT0RVTEVfTk9UX0ZPVU5EXCIgfHwgZS5tZXNzYWdlLnNwbGl0KFwiJ1wiKVsxXSAhPT0gb3B0aW9uc1BhdGgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgQ09ERTAwMDAwMDA5IElOUFJJTlQgZmFpbGVkIHRvIGxvYWQgJyR7b3B0aW9uc1BhdGh9JyBiZWNhdXNlIG9mIGV4Y2VwdGlvbjpgKTtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICghb3B0aW9uczApXHJcbiAgICAgICAgb3B0aW9uc1BhdGggPSBcIjxkZWZhdWx0IG9wdGlvbnM+XCI7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9uczogSW5wcmludE9wdGlvbnMgPSB7IC4uLmRlZmF1bHRJbnByaW50T3B0aW9ucywgLi4ub3B0aW9uczAgfTtcclxuICAgIGxldCBwcm9jZXNzZWRDb3VudCA9IDA7XHJcbiAgICAoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGlmIChvcHRpb25zLmxvZ2dpbmcpIGNvbnNvbGUubG9nKGBDT0RFMDAwMDAwMDUgSU5QUklOVCBvcHRpb25zIGZyb20gJHtvcHRpb25zUGF0aH1gKTtcclxuICAgICAgICBjb25zdCBwYXRocyA9IGF3YWl0IGdsb2JieShvcHRpb25zLmZpbGVzKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgZmlsZVBhdGggb2YgcGF0aHMpIHtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMubG9nZ2luZyA9PT0gXCJmaWxlc1wiKSBjb25zb2xlLmxvZyhgQ09ERTAwMDAwMDA2IElOUFJJTlQgJHtmaWxlUGF0aH1gKTtcclxuICAgICAgICAgICAgaWYgKGZpbGVQYXRoLmluY2x1ZGVzKFwibm9kZV9tb2R1bGVzXCIpICYmIG9wdGlvbnMuc2tpcE5vZGVNb2R1bGVzKSBjb250aW51ZTtcclxuICAgICAgICAgICAgaWYgKGhhbmRsZUZpbGUoZmlsZVBhdGgsIG9wdGlvbnMpKSBwcm9jZXNzZWRDb3VudCsrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucy5sb2dnaW5nKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICAgICAgICAgIGBDT0RFMDAwMDAwMDcgSU5QUklOVCBmaW5pc2hlZCwgJHtwYXRocy5sZW5ndGh9IC0gdG90YWwgZmlsZXMsICR7cHJvY2Vzc2VkQ291bnR9IC0gcHJvY2Vzc2VkLCAke1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGhzLmxlbmd0aCAtIHByb2Nlc3NlZENvdW50XHJcbiAgICAgICAgICAgICAgICB9IC0gc2tpcHBlZGBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICBpZihvcHRpb25zLmZvcmNlUHJvY2Vzc1Rlcm1pbmF0aW9uKVxyXG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoMCk7XHJcbiAgICB9KSgpO1xyXG59XHJcbiJdfQ==