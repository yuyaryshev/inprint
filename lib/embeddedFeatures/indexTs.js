"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.inprintIndexTs = inprintIndexTs;
exports.indexTsEmbeddedFeature = void 0;

var _fs = require("fs");

var _path = require("path");

const indexTsEmbeddedFeature = {
  name: "IndexTs",
  description: `Generates reexport for each file inside directory. 
Use exclude:['name1','name2'] to exclude some files. 
Use merge:[{name:'MERGE_NAME', suffix:'MERGE_SUFFIX'}] to merge exported consts with specified MERGE_SUFFIX as an array into one variable MERGE_NAME`,
  func: inprintIndexTs
};
exports.indexTsEmbeddedFeature = indexTsEmbeddedFeature;
const allowedExtensions = new Set(["js", "mjs", "cjs", "jsx", "ts", "tsx"]);

function inprintIndexTs(paramsObject, options) {
  if (!paramsObject.absolutePath.endsWith("/index.ts")) return undefined;
  const excludes = new Set([...((paramsObject === null || paramsObject === void 0 ? void 0 : paramsObject.excludes) || []), ...((paramsObject === null || paramsObject === void 0 ? void 0 : paramsObject.exclude) || []), ...((paramsObject === null || paramsObject === void 0 ? void 0 : paramsObject.excluding) || [])]);
  const merges = [...new Set([...((paramsObject === null || paramsObject === void 0 ? void 0 : paramsObject.merge) || [])])];
  excludes.add("index");
  const baseParts = (0, _path.resolve)(paramsObject.absolutePath.split("/").slice(0, -1).join("/"));
  const fileNames = [];

  for (let dirent of (0, _fs.readdirSync)(baseParts, {
    withFileTypes: true
  })) {
    if (dirent.isDirectory()) continue;
    const fileName = dirent.name;
    const temp = fileName.split(".");
    const ext = temp[temp.length - 1];
    if (!allowedExtensions.has(ext)) continue;
    const nameWoExt = fileName.split(".").slice(0, -1).join(".");
    if (!paramsObject.includeTests && nameWoExt.endsWith(".test")) continue;
    if (excludes.has(fileName) || excludes.has(nameWoExt)) continue;
    fileNames.push(nameWoExt);
  }

  fileNames.sort();
  const reexports = fileNames.map(f => `export * from "./${f}${options.appendJsInImports ? ".js" : ""}";`).join("\n");
  const mergeArrayBlocks = [];

  for (let mergeDefinition of merges) {
    const mergeLines = [];
    const mergeVars = [];

    for (let nameWoExt of fileNames) {
      mergeLines.push(`import {${nameWoExt}${mergeDefinition.suffix}} from "./${nameWoExt}";`);
      mergeVars.push(`${nameWoExt}${mergeDefinition.suffix}`);
    }

    mergeArrayBlocks.push(`
${mergeLines.join("\n")}
export const ${mergeDefinition.name} = [${mergeVars.join(", ")}];
`.trim());
  }

  const r = `
${reexports}

${mergeArrayBlocks.join("\n\n")}
`.trim();
  if (!r.length) return `export const unused901723 = 0; // No files found!`;
  return r;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lbWJlZGRlZEZlYXR1cmVzL2luZGV4VHMudHMiXSwibmFtZXMiOlsiaW5kZXhUc0VtYmVkZGVkRmVhdHVyZSIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsImZ1bmMiLCJpbnByaW50SW5kZXhUcyIsImFsbG93ZWRFeHRlbnNpb25zIiwiU2V0IiwicGFyYW1zT2JqZWN0Iiwib3B0aW9ucyIsImFic29sdXRlUGF0aCIsImVuZHNXaXRoIiwidW5kZWZpbmVkIiwiZXhjbHVkZXMiLCJleGNsdWRlIiwiZXhjbHVkaW5nIiwibWVyZ2VzIiwibWVyZ2UiLCJhZGQiLCJiYXNlUGFydHMiLCJzcGxpdCIsInNsaWNlIiwiam9pbiIsImZpbGVOYW1lcyIsImRpcmVudCIsIndpdGhGaWxlVHlwZXMiLCJpc0RpcmVjdG9yeSIsImZpbGVOYW1lIiwidGVtcCIsImV4dCIsImxlbmd0aCIsImhhcyIsIm5hbWVXb0V4dCIsImluY2x1ZGVUZXN0cyIsInB1c2giLCJzb3J0IiwicmVleHBvcnRzIiwibWFwIiwiZiIsImFwcGVuZEpzSW5JbXBvcnRzIiwibWVyZ2VBcnJheUJsb2NrcyIsIm1lcmdlRGVmaW5pdGlvbiIsIm1lcmdlTGluZXMiLCJtZXJnZVZhcnMiLCJzdWZmaXgiLCJ0cmltIiwiciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFJTyxNQUFNQSxzQkFBdUMsR0FBRztBQUNuREMsRUFBQUEsSUFBSSxFQUFFLFNBRDZDO0FBRW5EQyxFQUFBQSxXQUFXLEVBQUc7QUFDbEI7QUFDQSxxSkFKdUQ7QUFLbkRDLEVBQUFBLElBQUksRUFBRUM7QUFMNkMsQ0FBaEQ7O0FBUVAsTUFBTUMsaUJBQWlCLEdBQUcsSUFBSUMsR0FBSixDQUFRLENBQUMsSUFBRCxFQUFPLEtBQVAsRUFBYyxLQUFkLEVBQXFCLEtBQXJCLEVBQTRCLElBQTVCLEVBQWtDLEtBQWxDLENBQVIsQ0FBMUI7O0FBRU8sU0FBU0YsY0FBVCxDQUF3QkcsWUFBeEIsRUFBMkNDLE9BQTND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SUFBWCxDQUFpQixXQUFVRixTQUFVLEdBQUVTLGVBQWUsQ0FBQ0csTUFBTyxhQUFZWixTQUFVLElBQXBGO0FBQ0FXLE1BQUFBLFNBQVMsQ0FBQ1QsSUFBVixDQUFnQixHQUFFRixTQUFVLEdBQUVTLGVBQWUsQ0FBQ0csTUFBTyxFQUFyRDtBQUNIOztBQUNESixJQUFBQSxnQkFBZ0IsQ0FBQ04sSUFBakIsQ0FDSztBQUNiLEVBQUVRLFVBQVUsQ0FBQ3BCLElBQVgsQ0FBZ0IsSUFBaEIsQ0FBc0I7QUFDeEIsZUFBZW1CLGVBQWUsQ0FBQ3ZDLElBQUssT0FBTXlDLFNBQVMsQ0FBQ3JCLElBQVYsQ0FBZSxJQUFmLENBQXFCO0FBQy9ELENBSFksQ0FHVnVCLElBSFUsRUFESjtBQU1IOztBQUVELFFBQU1DLENBQUMsR0FBSTtBQUNmLEVBQUVWLFNBQVU7QUFDWjtBQUNBLEVBQUVJLGdCQUFnQixDQUFDbEIsSUFBakIsQ0FBc0IsTUFBdEIsQ0FBOEI7QUFDaEMsQ0FKYyxDQUladUIsSUFKWSxFQUFWO0FBTUEsTUFBSSxDQUFDQyxDQUFDLENBQUNoQixNQUFQLEVBQWUsT0FBUSxtREFBUjtBQUVmLFNBQU9nQixDQUFQO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZWFkZGlyU3luYyB9IGZyb20gXCJmc1wiO1xyXG5pbXBvcnQgeyByZXNvbHZlIH0gZnJvbSBcInBhdGhcIjtcclxuaW1wb3J0IHsgRW1iZWRkZWRGZWF0dXJlIH0gZnJvbSBcIi4uL0VtYmVkZGVkRmVhdHVyZVwiO1xyXG5pbXBvcnQgeyBJbnByaW50T3B0aW9ucyB9IGZyb20gXCIuLi9JbnByaW50T3B0aW9uc1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IGluZGV4VHNFbWJlZGRlZEZlYXR1cmU6IEVtYmVkZGVkRmVhdHVyZSA9IHtcclxuICAgIG5hbWU6IFwiSW5kZXhUc1wiLFxyXG4gICAgZGVzY3JpcHRpb246IGBHZW5lcmF0ZXMgcmVleHBvcnQgZm9yIGVhY2ggZmlsZSBpbnNpZGUgZGlyZWN0b3J5LiBcclxuVXNlIGV4Y2x1ZGU6WyduYW1lMScsJ25hbWUyJ10gdG8gZXhjbHVkZSBzb21lIGZpbGVzLiBcclxuVXNlIG1lcmdlOlt7bmFtZTonTUVSR0VfTkFNRScsIHN1ZmZpeDonTUVSR0VfU1VGRklYJ31dIHRvIG1lcmdlIGV4cG9ydGVkIGNvbnN0cyB3aXRoIHNwZWNpZmllZCBNRVJHRV9TVUZGSVggYXMgYW4gYXJyYXkgaW50byBvbmUgdmFyaWFibGUgTUVSR0VfTkFNRWAsXHJcbiAgICBmdW5jOiBpbnByaW50SW5kZXhUcyxcclxufTtcclxuXHJcbmNvbnN0IGFsbG93ZWRFeHRlbnNpb25zID0gbmV3IFNldChbXCJqc1wiLCBcIm1qc1wiLCBcImNqc1wiLCBcImpzeFwiLCBcInRzXCIsIFwidHN4XCJdKTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbnByaW50SW5kZXhUcyhwYXJhbXNPYmplY3Q6IGFueSwgb3B0aW9uczogSW5wcmludE9wdGlvbnMpIHtcclxuICAgIGlmICghcGFyYW1zT2JqZWN0LmFic29sdXRlUGF0aC5lbmRzV2l0aChcIi9pbmRleC50c1wiKSkgcmV0dXJuIHVuZGVmaW5lZDtcclxuXHJcbiAgICBjb25zdCBleGNsdWRlcyA9IG5ldyBTZXQoW1xyXG4gICAgICAgIC4uLihwYXJhbXNPYmplY3Q/LmV4Y2x1ZGVzIHx8IFtdKSxcclxuICAgICAgICAuLi4ocGFyYW1zT2JqZWN0Py5leGNsdWRlIHx8IFtdKSxcclxuICAgICAgICAuLi4ocGFyYW1zT2JqZWN0Py5leGNsdWRpbmcgfHwgW10pLFxyXG4gICAgXSk7XHJcblxyXG4gICAgY29uc3QgbWVyZ2VzID0gWy4uLm5ldyBTZXQoWy4uLihwYXJhbXNPYmplY3Q/Lm1lcmdlIHx8IFtdKV0pXTtcclxuXHJcbiAgICBleGNsdWRlcy5hZGQoXCJpbmRleFwiKTtcclxuICAgIGNvbnN0IGJhc2VQYXJ0cyA9IHJlc29sdmUocGFyYW1zT2JqZWN0LmFic29sdXRlUGF0aC5zcGxpdChcIi9cIikuc2xpY2UoMCwgLTEpLmpvaW4oXCIvXCIpKTtcclxuXHJcbiAgICBjb25zdCBmaWxlTmFtZXMgPSBbXTtcclxuICAgIGZvciAobGV0IGRpcmVudCBvZiByZWFkZGlyU3luYyhiYXNlUGFydHMsIHsgd2l0aEZpbGVUeXBlczogdHJ1ZSB9KSkge1xyXG4gICAgICAgIGlmIChkaXJlbnQuaXNEaXJlY3RvcnkoKSkgY29udGludWU7XHJcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBkaXJlbnQubmFtZTtcclxuICAgICAgICBjb25zdCB0ZW1wID0gZmlsZU5hbWUuc3BsaXQoXCIuXCIpO1xyXG4gICAgICAgIGNvbnN0IGV4dCA9IHRlbXBbdGVtcC5sZW5ndGggLSAxXTtcclxuICAgICAgICBpZiAoIWFsbG93ZWRFeHRlbnNpb25zLmhhcyhleHQpKSBjb250aW51ZTtcclxuICAgICAgICBjb25zdCBuYW1lV29FeHQgPSBmaWxlTmFtZS5zcGxpdChcIi5cIikuc2xpY2UoMCwgLTEpLmpvaW4oXCIuXCIpO1xyXG4gICAgICAgIGlmICghcGFyYW1zT2JqZWN0LmluY2x1ZGVUZXN0cyAmJiBuYW1lV29FeHQuZW5kc1dpdGgoXCIudGVzdFwiKSkgY29udGludWU7XHJcbiAgICAgICAgaWYgKGV4Y2x1ZGVzLmhhcyhmaWxlTmFtZSkgfHwgZXhjbHVkZXMuaGFzKG5hbWVXb0V4dCkpIGNvbnRpbnVlO1xyXG4gICAgICAgIGZpbGVOYW1lcy5wdXNoKG5hbWVXb0V4dCk7XHJcbiAgICB9XHJcbiAgICBmaWxlTmFtZXMuc29ydCgpO1xyXG5cclxuICAgIGNvbnN0IHJlZXhwb3J0cyA9IGZpbGVOYW1lc1xyXG4gICAgICAgIC5tYXAoKGYpID0+IGBleHBvcnQgKiBmcm9tIFwiLi8ke2Z9JHtvcHRpb25zLmFwcGVuZEpzSW5JbXBvcnRzID8gXCIuanNcIiA6IFwiXCJ9XCI7YClcclxuICAgICAgICAuam9pbihcIlxcblwiKTtcclxuXHJcbiAgICBjb25zdCBtZXJnZUFycmF5QmxvY2tzID0gW107XHJcbiAgICBmb3IgKGxldCBtZXJnZURlZmluaXRpb24gb2YgbWVyZ2VzKSB7XHJcbiAgICAgICAgY29uc3QgbWVyZ2VMaW5lcyA9IFtdO1xyXG4gICAgICAgIGNvbnN0IG1lcmdlVmFycyA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IG5hbWVXb0V4dCBvZiBmaWxlTmFtZXMpIHtcclxuICAgICAgICAgICAgbWVyZ2VMaW5lcy5wdXNoKGBpbXBvcnQgeyR7bmFtZVdvRXh0fSR7bWVyZ2VEZWZpbml0aW9uLnN1ZmZpeH19IGZyb20gXCIuLyR7bmFtZVdvRXh0fVwiO2ApO1xyXG4gICAgICAgICAgICBtZXJnZVZhcnMucHVzaChgJHtuYW1lV29FeHR9JHttZXJnZURlZmluaXRpb24uc3VmZml4fWApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtZXJnZUFycmF5QmxvY2tzLnB1c2goXHJcbiAgICAgICAgICAgIGBcclxuJHttZXJnZUxpbmVzLmpvaW4oXCJcXG5cIil9XHJcbmV4cG9ydCBjb25zdCAke21lcmdlRGVmaW5pdGlvbi5uYW1lfSA9IFske21lcmdlVmFycy5qb2luKFwiLCBcIil9XTtcclxuYC50cmltKClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHIgPSBgXHJcbiR7cmVleHBvcnRzfVxyXG5cclxuJHttZXJnZUFycmF5QmxvY2tzLmpvaW4oXCJcXG5cXG5cIil9XHJcbmAudHJpbSgpO1xyXG5cclxuICAgIGlmICghci5sZW5ndGgpIHJldHVybiBgZXhwb3J0IGNvbnN0IHVudXNlZDkwMTcyMyA9IDA7IC8vIE5vIGZpbGVzIGZvdW5kIWA7XHJcblxyXG4gICAgcmV0dXJuIHI7XHJcbn1cclxuIl19